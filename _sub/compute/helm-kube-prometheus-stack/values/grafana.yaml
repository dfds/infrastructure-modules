grafana:
  image:
    tag: 9.4.0-beta1 # TODO: Remove when Grafana 9.4.0 is released AND becomes part of kube-prometheus-stack
  resources:
    requests:
      cpu: 50m
      memory: 200Mi
  adminPassword: "${grafana_admin_password}"
  priorityClassName: ${grafana_priorityclass}
  grafana.ini:
    database:
      wal: true
    auth.anonymous:
      enabled: true
    metrics:
      enabled: true
    server:
      domain: ${grafana_host}
      root_url: ${grafana_root_url}
  ingress:
    enabled: false
    hosts:
      - ${grafana_host}
    path: ${grafana_ingress_path}
  plugins:
    - grafana-polystat-panel
  rbac:
    pspEnabled: true
  serviceAccount:
    name: ${grafana_serviceaccount_name}
    create: true
    annotations:
      eks.amazonaws.com/role-arn: ${grafana_cloudwatch_role}
      eks.amazonaws.com/sts-regional-endpoints: "true"
%{ if length(tolerations) > 0 ~}
  tolerations:
%{ for t in tolerations ~}
  - key: ${t.key}
    operator: ${t.operator}
%{ if t.value != null ~}
    value: ${t.value}
%{ endif ~}
    effect: ${t.effect}
%{ endfor ~}
%{ endif ~}
%{ if length(affinity) > 0 ~}
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 1
        preference:
          matchExpressions:
%{ for a in affinity ~}
          - key: ${a.key}
            operator: ${a.operator}
            values:
%{ for v in a.values ~}
            - ${ v }
%{ endfor ~}
%{ endfor ~}
%{ endif ~}
